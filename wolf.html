<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Werwolf Spiel</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&family=Open+Sans&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: 'Open Sans', sans-serif;
      background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
      background-size: cover;
      color: #f7d874;
      overflow-x: hidden;
    }
    #container {
      max-width: 900px;
      margin: 3em auto 5em;
      background: rgba(18, 18, 20, 0.85);
      border-radius: 20px;
      padding: 2.5em 3em 3em;
      box-shadow: 0 0 40px 6px #ffd700aa;
    }
    h1, h2, h3 {
      font-family: 'Cinzel Decorative', cursive;
      text-shadow: 2px 2px 6px #000;
      margin-bottom: 0.7em;
    }
    h1 {
      font-size: 3.2em;
      text-align: center;
      margin-top: 0;
    }
    input[type="text"], input[type="password"] {
      font-size: 1.1em;
      padding: 0.6em 1em;
      border-radius: 8px;
      border: none;
      width: 60%;
      max-width: 300px;
      margin-bottom: 1.2em;
      box-shadow: inset 1px 1px 5px #222;
      color: #222;
      font-weight: 600;
      font-family: 'Open Sans', sans-serif;
      display: inline-block;
    }
    button {
      background-color: #f7d874;
      border: none;
      border-radius: 12px;
      padding: 0.7em 1.6em;
      font-weight: 700;
      font-family: 'Cinzel Decorative', cursive;
      font-size: 1.1em;
      cursor: pointer;
      color: #1a1a1a;
      box-shadow: 0 0 12px 1px #ffd700cc;
      transition: background-color 0.3s ease, color 0.3s ease;
      margin-left: 0.5em;
      user-select: none;
    }
    button:hover {
      background-color: #e5c75c;
      color: #0d0d0d;
    }
    #playersList {
      margin-top: 1em;
      max-height: 380px;
      overflow-y: auto;
      padding-right: 10px;
    }
    .card {
      background: rgba(255, 215, 0, 0.1);
      margin-bottom: 1em;
      padding: 0.9em 1.2em;
      border-radius: 14px;
      box-shadow: inset 0 0 15px #f7d87444;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 600;
      color: #f7d874;
      font-family: 'Cinzel Decorative', cursive;
    }
    .player-name {
      flex: 1.4;
      font-size: 1.15em;
      text-shadow: 1px 1px 3px #0008;
    }
    .role-name {
      flex: 1.8;
      text-align: center;
      font-size: 1.05em;
      font-style: italic;
      color: #f7d874cc;
      user-select: none;
    }
    .status-btn {
      flex-shrink: 0;
      background-color: #c72b2b;
      color: white;
      padding: 0.35em 0.75em;
      font-family: 'Open Sans', sans-serif;
      font-weight: 700;
      font-size: 0.95em;
      border-radius: 8px;
      border: none;
      box-shadow: 0 0 6px #c72b2bcc;
      transition: background-color 0.3s ease;
      user-select: none;
      cursor: pointer;
    }
    .status-btn:hover {
      background-color: #9a2020;
    }
    .alive {
      background: rgba(39, 101, 39, 0.35);
      box-shadow: inset 0 0 15px #74c574cc;
    }
    .dead {
      background: rgba(120, 0, 0, 0.5);
      box-shadow: inset 0 0 15px #ff5050cc;
      text-decoration: line-through;
      color: #ffa2a2;
    }
    #masterLogin {
      margin-top: 3em;
      text-align: center;
    }
    #masterView {
      margin-top: 2em;
      background: rgba(39, 39, 39, 0.95);
      border-radius: 20px;
      padding: 2em 2.5em;
      max-height: 500px;
      overflow-y: auto;
      box-shadow: 0 0 50px 7px #ffd700bb;
      font-family: 'Cinzel Decorative', cursive;
      color: #f7d874;
    }

    /* Erzähler Tabelle für Beamer */
    #masterTable {
      width: 100%;
      border-collapse: collapse;
      font-size: 1.3em;
      user-select: none;
    }
    #masterTable th, #masterTable td {
      border: 2px solid #f7d874cc;
      padding: 0.75em 1.2em;
      text-align: center;
    }
    #masterTable th {
      background: #b38f00cc;
      text-shadow: 1px 1px 2px #000;
    }
    #masterTable tbody tr.alive {
      background: rgba(39, 101, 39, 0.4);
      color: #e9ffd9;
      font-weight: 700;
      box-shadow: inset 0 0 10px #74c574cc;
    }
    #masterTable tbody tr.dead {
      background: rgba(120, 0, 0, 0.6);
      color: #ffbebe;
      text-decoration: line-through;
      font-style: italic;
      box-shadow: inset 0 0 12px #ff5050cc;
    }
    #masterTable tbody tr:hover {
      background: #ffd70088;
      color: #1a1a1a;
      cursor: default;
    }
    #closeMasterView {
      margin-top: 1.2em;
      font-family: 'Cinzel Decorative', cursive;
      font-size: 1.15em;
      padding: 0.6em 1.5em;
      border-radius: 14px;
      box-shadow: 0 0 15px 4px #ffd700bb;
      cursor: pointer;
    }
    #closeMasterView:hover {
      background-color: #e5c75c;
      color: #0d0d0d;
    }
    #infoBox {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(18, 18, 20, 0.95);
      color: #f7d874;
      border-radius: 25px;
      padding: 2.5em 3em;
      max-width: 520px;
      box-shadow: 0 0 50px 10px #ffd700cc;
      z-index: 11000;
      font-size: 1.05em;
      font-family: 'Cinzel Decorative', cursive;
    }
    #infoBox ul {
      margin-top: 0.7em;
      padding-left: 1.3em;
      line-height: 1.5;
    }
    #infoBox li {
      margin-bottom: 0.7em;
    }
    #infoBox .close-btn {
      margin-top: 1.8em;
      background-color: #f7d874;
      color: #1a1a1a;
      font-family: 'Cinzel Decorative', cursive;
      font-size: 1.2em;
      padding: 0.55em 1.5em;
      border-radius: 15px;
      box-shadow: 0 0 10px 2px #ffd700cc;
      cursor: pointer;
      user-select: none;
      border: none;
    }
    #infoBox .close-btn:hover {
      background-color: #e5c75c;
    }
    #impressum {
      position: fixed;
      bottom: 8px;
      right: 12px;
      font-size: 0.85em;
      font-family: 'Open Sans', sans-serif;
      color: #f7d874aa;
      text-shadow: 1px 1px 3px #0008;
      user-select: none;
      z-index: 12000;
    }
    #masterLogin input,
    #masterLogin button {
      vertical-align: middle;
    }
    #qr {
      position: fixed;
      bottom: 8px;
      left: 8px;
      background: rgba(18, 18, 20, 0.6);
      padding: 0.3em 0.5em;
      border-radius: 10px;
      box-shadow: 0 0 10px 1px #ffd70088;
      text-align: center;
      z-index: 10000;
      user-select: none;
      opacity: 0.45;
      transition: opacity 0.3s ease;
    }
    #qr:hover {
      opacity: 0.9;
    }
    #qr h3 {
      font-family: 'Cinzel Decorative', cursive;
      font-size: 1em;
      color: #f7d874cc;
      margin: 0 0 0.3em 0;
      user-select: none;
      pointer-events: none;
    }
    #qr img {
      width: 60px;
      height: 60px;
      user-select: none;
      pointer-events: none;
      filter: drop-shadow(0 0 2px #0009);
      border-radius: 8px;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Werwolf Spiel</h1>
    <p>Spieler-Namen eingeben und Rollen werden zufällig verteilt. Danach kann der Erzähler den Überblick behalten.</p>
    <div>
      <input type="text" id="playerNameInput" placeholder="Neuen Spielernamen eingeben" />
      <button id="addPlayerBtn">Spieler hinzufügen</button>
    </div>
    <div id="playersList"></div>
    <button id="assignRolesBtn" style="margin-top: 1.4em;">Rollen verteilen</button>

    <div id="masterLogin" style="margin-top: 2.5em;">
      <input type="password" id="masterPassword" placeholder="Erzähler Passwort" />
      <button id="masterLoginBtn">Erzähler Login</button>
    </div>

    <div id="masterView" style="display:none;">
      <h2>Erzähler Übersicht</h2>
      <table id="masterTable">
        <thead>
          <tr><th>Spieler</th><th>Rolle</th><th>Status</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <button id="closeMasterView">Erzähler Übersicht schließen</button>
    </div>
  </div>

  <div id="qr" title="QR-Code zum Spiel" aria-label="QR-Code zum Spiel">
    <h3>Spiel-App</h3>
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=https%3A%2F%2Fwerwolf-spiel.example.com" alt="QR-Code" />
  </div>

<script>
  // Spieler-Array
  let players = [];

  // Rollen-Liste
  const roles = [
    "Werwolf",
    "Werwolf",
    "Seher",
    "Hexe",
    "Bürger",
    "Bürger",
    "Bürger",
    "Bürger"
  ];

  // DOM Elemente
  const playerNameInput = document.getElementById('playerNameInput');
  const addPlayerBtn = document.getElementById('addPlayerBtn');
  const playersList = document.getElementById('playersList');
  const assignRolesBtn = document.getElementById('assignRolesBtn');
  const masterLoginBtn = document.getElementById('masterLoginBtn');
  const masterPassword = document.getElementById('masterPassword');
  const masterView = document.getElementById('masterView');
  const masterTableBody = document.querySelector('#masterTable tbody');
  const closeMasterViewBtn = document.getElementById('closeMasterView');

  // Spieler hinzufügen
  addPlayerBtn.addEventListener('click', () => {
    const name = playerNameInput.value.trim();
    if (!name) return alert('Bitte einen Spielernamen eingeben.');
    if (players.find(p => p.name.toLowerCase() === name.toLowerCase())) {
      alert('Dieser Name ist bereits vergeben.');
      return;
    }
    players.push({ name: name, role: null, alive: true });
    playerNameInput.value = '';
    renderPlayersList();
  });

  // Enter-Taste auch möglich zum Hinzufügen
  playerNameInput.addEventListener('keypress', e => {
    if (e.key === 'Enter') addPlayerBtn.click();
  });

  // Spielerliste anzeigen
  function renderPlayersList() {
    playersList.innerHTML = '';
    players.forEach((player, idx) => {
      const card = document.createElement('div');
      card.className = 'card ' + (player.alive ? 'alive' : 'dead');
      const nameSpan = document.createElement('span');
      nameSpan.textContent = player.name;
      nameSpan.className = 'player-name';
      const roleSpan = document.createElement('span');
      roleSpan.className = 'role-name';
      roleSpan.textContent = player.role ? player.role : '–';
      const statusBtn = document.createElement('button');
      statusBtn.className = 'status-btn';
      statusBtn.textContent = player.alive ? 'Tot' : 'Lebendig';
      statusBtn.title = player.alive ? 'Spieler auf tot setzen' : 'Spieler auf lebendig setzen';
      statusBtn.addEventListener('click', () => {
        player.alive = !player.alive;
        renderPlayersList();
      });
      card.appendChild(nameSpan);
      card.appendChild(roleSpan);
      card.appendChild(statusBtn);
      playersList.appendChild(card);
    });
  }

  // Rollen zufällig zuweisen
  assignRolesBtn.addEventListener('click', () => {
    if (players.length < roles.length) {
      alert(`Mindestens ${roles.length} Spieler benötigt.`);
      return;
    }
    // Shuffle roles
    const shuffledRoles = roles.slice().sort(() => Math.random() - 0.5);
    for (let i = 0; i < players.length; i++) {
      players[i].role = i < shuffledRoles.length ? shuffledRoles[i] : "Bürger";
      players[i].alive = true;
    }
    renderPlayersList();
    alert('Rollen wurden verteilt!');
  });

  // Erzähler Login
  masterLoginBtn.addEventListener('click', () => {
    const pw = masterPassword.value.trim();
    if (pw === 'werwolf123') {
      masterPassword.value = '';
      showMasterView();
    } else {
      alert('Falsches Passwort!');
    }
  });

  function showMasterView() {
    masterView.style.display = 'block';
    renderMasterTable();
  }

  closeMasterViewBtn.addEventListener('click', () => {
    masterView.style.display = 'none';
  });

  // Erzähler Tabelle rendern
  function renderMasterTable() {
    masterTableBody.innerHTML = '';
    players.forEach(player => {
      const tr = document.createElement('tr');
      tr.className = player.alive ? 'alive' : 'dead';
      const tdName = document.createElement('td');
      tdName.textContent = player.name;
      const tdRole = document.createElement('td');
      tdRole.textContent = player.role ? player.role : '–';
      const tdStatus = document.createElement('td');
      tdStatus.textContent = player.alive ? 'Lebendig' : 'Tot';
      tr.appendChild(tdName);
      tr.appendChild(tdRole);
      tr.appendChild(tdStatus);
      masterTableBody.appendChild(tr);
    });
  }

  // Tabelle bei Statusänderung aktualisieren
  // Wir erweitern die Status-Button Funktion mit erneuter Master-Tabelle Render
  function updateStatus(idx) {
    players[idx].alive = !players[idx].alive;
    renderPlayersList();
    if (masterView.style.display === 'block') renderMasterTable();
  }

  // Im Spieler-Status-Button die Funktion anpassen:
  // Deshalb neu renderPlayersList mit updateStatus ändern
  function renderPlayersList() {
    playersList.innerHTML = '';
    players.forEach((player, idx) => {
      const card = document.createElement('div');
      card.className = 'card ' + (player.alive ? 'alive' : 'dead');
      const nameSpan = document.createElement('span');
      nameSpan.textContent = player.name;
      nameSpan.className = 'player-name';
      const roleSpan = document.createElement('span');
      roleSpan.className = 'role-name';
      roleSpan.textContent = player.role ? player.role : '–';
      const statusBtn = document.createElement('button');
      statusBtn.className = 'status-btn';
      statusBtn.textContent = player.alive ? 'Tot' : 'Lebendig';
      statusBtn.title = player.alive ? 'Spieler auf tot setzen' : 'Spieler auf lebendig setzen';
      statusBtn.addEventListener('click', () => {
        updateStatus(idx);
      });
      card.appendChild(nameSpan);
      card.appendChild(roleSpan);
      card.appendChild(statusBtn);
      playersList.appendChild(card);
    });
  }

</script>
</body>
</html>
